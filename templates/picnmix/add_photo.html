{% extends 'picnmix/base.html' %}
{% load staticfiles %}

{% block title_block %}
    Add a page
{% endblock %}

{% block body_block %}

    {% if album %}
        <!-- SECOND LEVEL ACTION MENU -->
        <div class="container-fluid menu">
            <div class="container">
                <ul class="nav">
                    <li class="nav-item"><a class="nav-link"><span
                            class="nav-title">{{ album.album_name }} - Add a photo</span></a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="/picnmix/"><span
                            class="fa fa-home fa-lg accent"></span>Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/picnmix/album/{{ album.slug }}"><span
                            class="fa fa-arrow-left fa-lg accent"></span>Back to album</a></li>
                </ul>
            </div>
        </div>

        <div class="container">
        <div class="row">

        <div class="col-sm-6 col-md-6 col-lg-6 offset-3">
        <div class="card form">
        <div class="form-header">
            <div class="form-title">
                <h3>Add a photo</h3>
                <h5>Select a photo to upload to the {{ album.album_name }} album:</h5>
            </div>
            <div class="form-icon">
                <span class="fa fa-plus-square"></span>
            </div>
        </div>

        <div class="form-main">
            <div class="form-group">
                <form method="post" action="/picnmix/album/{{ album.slug }}/add_photo/"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form.image }}
                    {{ form.album_id }}
                    <button type="submit" name="submit" id="form-submit"
                            class="btn btn-lg btn-primary btn-block btn-default"
                            value="Create an album">Add a photo
                    </button>
                </form>
            </div>
        </div>













        <div class="card-footer">
        <!-- IMPORTANT enctype attribute! -->
        <form class="dropzone" action="/picnmix/album/{{ album.slug }}/add_photo/" method="post" enctype="multipart/form-data">
            {% csrf_token %}
        </form>
        <button id="submit-all">
            Submit all files
        </button>

        <script type="text/javascript">
            Dropzone.options.myDropzone = {

                // Prevents Dropzone from uploading dropped files immediately
                autoProcessQueue : false,

                init : function() {
                    var submitButton = document.querySelector("#submit-all")
                    myDropzone = this;

                    submitButton.addEventListener("click", function() {
                        myDropzone.processQueue();
                        // Tell Dropzone to process all queued files.
                    });

                    // You might want to show the submit button only when
                    // files are dropped here:
                    this.on("addedfile", function() {
                        // Show submit button here and/or inform user to click it.
                    });

                }
            };
        </script>
        </div>




















    {% else %}
        This album does not exist.
    {% endif %}

</div>
</div>




</div>
</div>

{% endblock %}
<!--
<div id="summary"><h1>Forbidden <span>(403)</span></h1>
  <p>CSRF verification failed. Request aborted.</p></div>
<div id="info"><h2>Help</h2>
  <p>Reason given for failure:</p>
  <pre> CSRF token missing or incorrect. </pre>
  <p>In general, this can occur when there is a genuine Cross Site Request Forgery, or when <a
      href="https://docs.djangoproject.com/en/1.10/ref/csrf/">Django's CSRF mechanism</a> has not been used correctly.
    For POST forms, you need to ensure:</p>
  <ul>
    <li>Your browser is accepting cookies.</li>
    <li>The view function passes a <code>request</code> to the template's <a
        href="https://docs.djangoproject.com/en/dev/topics/templates/#django.template.backends.base.Template.render"><code>render</code></a>
      method.
    </li>
    <li>In the template, there is a <code>{% csrf_token %}</code> template tag inside each POST form that targets an
      internal URL.
    </li>
    <li>If you are not using <code>CsrfViewMiddleware</code>, then you must use <code>csrf_protect</code> on any views
      that use the <code>csrf_token</code> template tag, as well as those that accept the POST data.
    </li>
    <li>The form has a valid CSRF token. After logging in in another browser tab or hitting the back button after a
      login, you may need to reload the page with the form, because the token is rotated after a login.
    </li>
  </ul>
  <p>You're seeing the help section of this page because you have <code>DEBUG = True</code> in your Django settings
    file. Change that to <code>False</code>, and only the initial error message will be displayed. </p>
  <p>You can customize this page using the CSRF_FAILURE_VIEW setting.</p></div>
-->

